<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Zhenkun Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://xiaozzk.github.io/img/home-backgroupd.jpg">
    <meta property="twitter:image" content="https://xiaozzk.github.io/img/home-backgroupd.jpg" />
    

    
    <meta name="title" content="SpringBoot AutoConfiguration源码解析" />
    <meta property="og:title" content="SpringBoot AutoConfiguration源码解析" />
    <meta property="twitter:title" content="SpringBoot AutoConfiguration源码解析" />
    

    
    <meta name="description" content="SpringBoot AutoConfiguration源码解析">
    <meta property="og:description" content="SpringBoot AutoConfiguration源码解析" />
    <meta property="twitter:description" content="SpringBoot AutoConfiguration源码解析" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="朱镇昆, Zhenkun, Zhenkun Blog, 博客, 个人网站, 互联网, Web, 微服务, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>SpringBoot AutoConfiguration源码解析 | 镇昆的博客 | Zhenkun Blog</title>

    <link rel="canonical" href="/post/springcloudautoconfiguration/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css" rel="stylesheet" type="text/css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>






<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Zhenkun Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">All Posts</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/life/">life</a>
                        </li>
                        
                        <li>
                            <a href="/categories/tech/">tech</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/about//">ABOUT</a></li>
                    
		            <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/home-backgroupd.jpg')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/java" title="java">
                            java
                        </a>
                        
                        <a class="tag" href="/tags/spring-boot" title="spring boot">
                            spring boot
                        </a>
                        
                    </div>
                    <h1>SpringBoot AutoConfiguration源码解析</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                Zhenkun
                             
                            on 
                            Tuesday, June 4, 2019
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <h1 id="1springboot-启动注解分析">1.Springboot 启动注解分析</h1>
<p>springboot启动类</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//SpringBootApplication注解用来标注一个主程序类，说明是一个springboot应用
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>@SpringBootApplication
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">DemoApplication</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">[]</span> args<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#ff79c6">.</span><span style="color:#50fa7b">run</span><span style="color:#ff79c6">(</span>DemoApplication<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">,</span> args<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>查看@SpringBootApplication 注解:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">@ComponentScan:自动扫描并加载符合条件的组件或者bean，将这个bean定义加载到IOC容器中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">@SpringBootConfiguration:标注在某个类上，表示这是一个springboot的配置类。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">@EnableAutoConfiguration:开启自动配置功能,之前在使用springboot的时候，springboot可以自动帮我们完成配置功能，@EnableAutoConfiguration告诉springboot开启自动配置功能，这样自动配置才能生效
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">*/</span>
</span></span><span style="display:flex;"><span>@Target<span style="color:#ff79c6">(</span>ElementType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">TYPE</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>@Retention<span style="color:#ff79c6">(</span>RetentionPolicy<span style="color:#ff79c6">.</span><span style="color:#50fa7b">RUNTIME</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>@Documented
</span></span><span style="display:flex;"><span>@Inherited
</span></span><span style="display:flex;"><span>@SpringBootConfiguration
</span></span><span style="display:flex;"><span>@EnableAutoConfiguration  
</span></span><span style="display:flex;"><span>@ComponentScan<span style="color:#ff79c6">(</span>excludeFilters <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span> @Filter<span style="color:#ff79c6">(</span>type <span style="color:#ff79c6">=</span> FilterType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">CUSTOM</span><span style="color:#ff79c6">,</span> classes <span style="color:#ff79c6">=</span> TypeExcludeFilter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">),</span>
</span></span><span style="display:flex;"><span>        @Filter<span style="color:#ff79c6">(</span>type <span style="color:#ff79c6">=</span> FilterType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">CUSTOM</span><span style="color:#ff79c6">,</span> classes <span style="color:#ff79c6">=</span> AutoConfigurationExcludeFilter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">})</span> 
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> @interface SpringBootApplication <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>查看@EnableAutoConfiguration 注解:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">/*
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">@AutoConfigurationPackage:自动配置包
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">@Import(AutoConfigurationImportSelector.class)：导入哪些组件的选择器，它将所有需要导入的组件以全类名的方式返回，这些组件就会被添加到容器中，它会给容器中导入非常多的自动配置类，就是给容器中导入这个场景需要的所有组件，并配置好这些组件
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">*/</span>
</span></span><span style="display:flex;"><span>@Target<span style="color:#ff79c6">(</span>ElementType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">TYPE</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>@Retention<span style="color:#ff79c6">(</span>RetentionPolicy<span style="color:#ff79c6">.</span><span style="color:#50fa7b">RUNTIME</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>@Documented
</span></span><span style="display:flex;"><span>@Inherited
</span></span><span style="display:flex;"><span>@AutoConfigurationPackage
</span></span><span style="display:flex;"><span>@Import<span style="color:#ff79c6">(</span>AutoConfigurationImportSelector<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> @interface EnableAutoConfiguration <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>查看@AutoConfigurationPackage 注解:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">/*
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">给容器导入一个组件，导入的组件由AutoConfigurationPackages.Registrar.class将主配置类（@SpringBootApplication标注的类）的所在包及包下面所有子包里面的所有组件扫描到spring容器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">*/</span>
</span></span><span style="display:flex;"><span>@Target<span style="color:#ff79c6">(</span>ElementType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">TYPE</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>@Retention<span style="color:#ff79c6">(</span>RetentionPolicy<span style="color:#ff79c6">.</span><span style="color:#50fa7b">RUNTIME</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>@Documented
</span></span><span style="display:flex;"><span>@Inherited
</span></span><span style="display:flex;"><span>@Import<span style="color:#ff79c6">(</span>AutoConfigurationPackages<span style="color:#ff79c6">.</span><span style="color:#50fa7b">Registrar</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> @interface AutoConfigurationPackage <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h1 id="2自动装配源码解析">2.自动装配源码解析</h1>
<p>org.springframework.boot.SpringApplication#run(java.lang.String&hellip;)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>   <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 运行Spring application, 创建并且更新ApplicationContext.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @param args 命令行参数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @return ApplicationContext
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> ConfigurableApplicationContext <span style="color:#50fa7b">run</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">...</span> args<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 用来记录当前springboot启动耗时
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>   StopWatch stopWatch <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> StopWatch<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">// 记录启动开始时间
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>   stopWatch<span style="color:#ff79c6">.</span><span style="color:#50fa7b">start</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">// spring上下文的接口， 接收ApplicationContext实现
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>   ConfigurableApplicationContext context <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>   Collection<span style="color:#ff79c6">&lt;</span>SpringBootExceptionReporter<span style="color:#ff79c6">&gt;</span> exceptionReporters <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ArrayList<span style="color:#ff79c6">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>   configureHeadlessProperty<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">// 通过spring.factroies中读取了SpringApplicationRunListener 的组件，用来发布事件或者运行监听器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>   SpringApplicationRunListeners listeners <span style="color:#ff79c6">=</span> getRunListeners<span style="color:#ff79c6">(</span>args<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">// 触发ApplicationStartingEvent的监听者执行onApplicationEvent
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>   listeners<span style="color:#ff79c6">.</span><span style="color:#50fa7b">starting</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>       <span style="color:#6272a4">// 根据命令行参数 实例化一个ApplicationArguments 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      ApplicationArguments applicationArguments <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> DefaultApplicationArguments<span style="color:#ff79c6">(</span>args<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">// 预初始化环境： 读取环境变量，读取配置文件信息（基于监听器）
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      ConfigurableEnvironment environment <span style="color:#ff79c6">=</span> prepareEnvironment<span style="color:#ff79c6">(</span>listeners<span style="color:#ff79c6">,</span> applicationArguments<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">// 忽略beaninfo的bean
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      configureIgnoreBeanInfo<span style="color:#ff79c6">(</span>environment<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">// 打印Banner
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      Banner printedBanner <span style="color:#ff79c6">=</span> printBanner<span style="color:#ff79c6">(</span>environment<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">// 根据webApplicationType创建Spring上下文
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      context <span style="color:#ff79c6">=</span> createApplicationContext<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>      exceptionReporters <span style="color:#ff79c6">=</span> getSpringFactoriesInstances<span style="color:#ff79c6">(</span>SpringBootExceptionReporter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">new</span> Class<span style="color:#ff79c6">[]</span> <span style="color:#ff79c6">{</span> ConfigurableApplicationContext<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span> <span style="color:#ff79c6">},</span> context<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>     <span style="color:#6272a4">// 准备应用上下文，该步骤包含一个非常关键的操作，将启动类注入容器，为后续开启自动化配置提供基础
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      prepareContext<span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">,</span> environment<span style="color:#ff79c6">,</span> listeners<span style="color:#ff79c6">,</span> applicationArguments<span style="color:#ff79c6">,</span> printedBanner<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">// 加载spring ioc 容器   **相当重要   由于是使用AnnotationConfigServletWebServerApplicationContext 启动的spring容器所以springboot对它做了扩展：
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      <span style="color:#6272a4">//  加载自动配置类：invokeBeanFactoryPostProcessors ，  创建servlet容器onRefresh
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      refreshContext<span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      afterRefresh<span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">,</span> applicationArguments<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      stopWatch<span style="color:#ff79c6">.</span><span style="color:#50fa7b">stop</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">logStartupInfo</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>         <span style="color:#ff79c6">new</span> StartupInfoLogger<span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">mainApplicationClass</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">logStarted</span><span style="color:#ff79c6">(</span>getApplicationLog<span style="color:#ff79c6">(),</span> stopWatch<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">// 发布ApplicationStartedEvent事件
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      listeners<span style="color:#ff79c6">.</span><span style="color:#50fa7b">started</span><span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      callRunners<span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">,</span> applicationArguments<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>Throwable ex<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      handleRunFailure<span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">,</span> ex<span style="color:#ff79c6">,</span> exceptionReporters<span style="color:#ff79c6">,</span> listeners<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> IllegalStateException<span style="color:#ff79c6">(</span>ex<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4">// 发布ApplicationReadyEvent事件
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>      listeners<span style="color:#ff79c6">.</span><span style="color:#50fa7b">running</span><span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>Throwable ex<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      handleRunFailure<span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">,</span> ex<span style="color:#ff79c6">,</span> exceptionReporters<span style="color:#ff79c6">,</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> IllegalStateException<span style="color:#ff79c6">(</span>ex<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">return</span> context<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>org.springframework.boot.autoconfigure.AutoConfigurationImportSelector#getAutoConfigurationEntry</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    * 获取符合条件的自动配置类，避免加载不必要的自动配置类从而造成内存浪费
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">protected</span> AutoConfigurationEntry <span style="color:#50fa7b">getAutoConfigurationEntry</span><span style="color:#ff79c6">(</span>AutoConfigurationMetadata autoConfigurationMetadata<span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>            AnnotationMetadata annotationMetadata<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取是否有配置spring.boot.enableautoconfiguration属性，默认返回true
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(!</span>isEnabled<span style="color:#ff79c6">(</span>annotationMetadata<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> EMPTY_ENTRY<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获得@Congiguration标注的Configuration类即被审视introspectedClass的注解数据，
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#6272a4">// 比如：@SpringBootApplication(exclude = FreeMarkerAutoConfiguration.class)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#6272a4">// 将会获取到exclude =和excludeName=&#34;&#34;的注解数据
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        AnnotationAttributes attributes <span style="color:#ff79c6">=</span> getAttributes<span style="color:#ff79c6">(</span>annotationMetadata<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 得到spring.factories文件配置的所有自动配置类
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        List<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">&gt;</span> configurations <span style="color:#ff79c6">=</span> getCandidateConfigurations<span style="color:#ff79c6">(</span>annotationMetadata<span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>                attributes<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 利用LinkedHashSet移除重复的配置类
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        configurations <span style="color:#ff79c6">=</span> removeDuplicates<span style="color:#ff79c6">(</span>configurations<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 得到要排除的自动配置类，比如注解属性exclude的配置类
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#6272a4">// 比如：@SpringBootApplication(exclude = FreeMarkerAutoConfiguration.class)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#6272a4">// 将会获取到exclude = FreeMarkerAutoConfiguration.class的注解数据
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        Set<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">&gt;</span> exclusions <span style="color:#ff79c6">=</span> getExclusions<span style="color:#ff79c6">(</span>annotationMetadata<span style="color:#ff79c6">,</span> attributes<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 检查要被排除的配置类，因为有些不是自动配置类，故要抛出异常
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        checkExcludedClasses<span style="color:#ff79c6">(</span>configurations<span style="color:#ff79c6">,</span> exclusions<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 将要排除的配置类移除
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        configurations<span style="color:#ff79c6">.</span><span style="color:#50fa7b">removeAll</span><span style="color:#ff79c6">(</span>exclusions<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 因为从spring.factories文件获取的自动配置类太多，如果有些不必要的自动配置类都加载进内存，会造成内存浪费，因此这里需要进行过滤
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#6272a4">// 注意这里会调用AutoConfigurationImportFilter的match方法来判断是否符合@ConditionalOnBean,@ConditionalOnClass或@ConditionalOnWebApplication
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        configurations <span style="color:#ff79c6">=</span> filter<span style="color:#ff79c6">(</span>configurations<span style="color:#ff79c6">,</span> autoConfigurationMetadata<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取了符合条件的自动配置类后，此时触发AutoConfigurationImportEvent事件，
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#6272a4">// 目的是告诉ConditionEvaluationReport条件评估报告器对象来记录符合条件的自动配置类
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#6272a4">// 该事件什么时候会被触发？--&gt; 在刷新容器时调用invokeBeanFactoryPostProcessors后置处理器时触发
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        fireAutoConfigurationImportEvents<span style="color:#ff79c6">(</span>configurations<span style="color:#ff79c6">,</span> exclusions<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 将符合条件和要排除的自动配置类封装进AutoConfigurationEntry对象，并返回
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> AutoConfigurationEntry<span style="color:#ff79c6">(</span>configurations<span style="color:#ff79c6">,</span> exclusions<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>org.springframework.boot.autoconfigure.AutoConfigurationImportSelector#getCandidateConfigurations</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">将类路径下 META-INF/spring.factories 里面配置的所有EnableAutoConfiguration的值加入到了容器中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">protected</span> List<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">getCandidateConfigurations</span><span style="color:#ff79c6">(</span>AnnotationMetadata metadata<span style="color:#ff79c6">,</span> AnnotationAttributes attributes<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//将类路径下 META-INF/spring.factories 里面配置的所有EnableAutoConfiguration的值取入集合中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        List<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">&gt;</span> configurations <span style="color:#ff79c6">=</span> SpringFactoriesLoader<span style="color:#ff79c6">.</span><span style="color:#50fa7b">loadFactoryNames</span><span style="color:#ff79c6">(</span>getSpringFactoriesLoaderFactoryClass<span style="color:#ff79c6">(),</span>
</span></span><span style="display:flex;"><span>                getBeanClassLoader<span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>        Assert<span style="color:#ff79c6">.</span><span style="color:#50fa7b">notEmpty</span><span style="color:#ff79c6">(</span>configurations<span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;No auto configuration classes found in META-INF/spring.factories. If you &#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;are using a custom packaging, make sure that file is correct.&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> configurations<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h1 id="3自定义自动配置类">3.自定义自动配置类</h1>
<p>1)新建一个springboot工程 xxx-spring-boot-starter 自定义配置类 建议命名
2)新建一个配置类 在配置类中创建一个Bean 对象</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//必须声明为一个配置类
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//可以定义配置生成条件
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">//@ConditionalOnWebApplication //web应该生效
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>@ConditionalOnJava<span style="color:#ff79c6">(</span>value <span style="color:#ff79c6">=</span> JavaVersion<span style="color:#ff79c6">.</span><span style="color:#50fa7b">THIRTEEN</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//可以引入自定义参数配置
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>@EnableConfigurationProperties<span style="color:#ff79c6">(</span>TestProperties<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">TestServiceAutoConfiguration</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    TestProperties testProperties<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> TestService <span style="color:#50fa7b">testService</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        TestService service <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> TestService<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>        service<span style="color:#ff79c6">.</span><span style="color:#50fa7b">setTestProperties</span><span style="color:#ff79c6">(</span>testProperties<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> service<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>参数配置类:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//定义参数配置前缀
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>@Data
</span></span><span style="display:flex;"><span>@ConfigurationProperties<span style="color:#ff79c6">(</span>prefix <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;demo&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">TestProperties</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String prefix<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String suffix<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>3）在 在resources目录下按照SpringBoot自动配置目录、文件名称的规则，如下图，新建一个自己的spring.factories文件。</p>
<p>并在 spring.factories文件 中添将自定义的自动配置类声明为名称为org.springframework.boot.autoconfigure.EnableAutoConfiguration的值，“\”的作用：换行，如果我们有多个自定义的自动配置类，这里可以用逗号分隔</p>
<pre tabindex="0"><code class="language-propertis" data-lang="propertis">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.isvmspace.demo.mystarter.TestServiceAutoConfiguration
</code></pre><p>自定义的自动配置类就创建好了</p>
<p>4）目标项目中只要引入对应自定义配置模块</p>
<pre tabindex="0"><code class="language-markup" data-lang="markup">        &lt;!-- 引入自动配置模块 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.isvmspace.demo.mystarter&lt;/groupId&gt;
            &lt;artifactId&gt;test-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><h1 id="附录-常用注解">附录-常用注解:</h1>
<p>@Conditional：自动配置类在一定条件下才能生效</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>@ConditionalOnJava</td>
<td>系统的java版本是否符合要求</td>
</tr>
<tr>
<td>@ConditionalOnBean</td>
<td>容器中存在指定Bean</td>
</tr>
<tr>
<td>@ConditionalOnMissingBean</td>
<td>容器中不存在指定Bean</td>
</tr>
<tr>
<td>@ConditionalOnExpression</td>
<td>满足SpEL表达式</td>
</tr>
<tr>
<td>@ConditionalOnClass</td>
<td>系统中有指定的类</td>
</tr>
<tr>
<td>@ConditionalOnMissingClass</td>
<td>系统中没有指定的类</td>
</tr>
<tr>
<td>@ConditionalOnSingleCandidate</td>
<td>容器中只有一个指定的Bean，或者是首选Bean</td>
</tr>
<tr>
<td>@ConditionalOnProperty</td>
<td>系统中指定的属性是否有指定的值</td>
</tr>
<tr>
<td>@ConditionalOnResource</td>
<td>类路径下是否存在指定资源文件</td>
</tr>
<tr>
<td>@ConditionOnWebApplication</td>
<td>当前是web环境</td>
</tr>
<tr>
<td>@ConditionalOnNotWebApplication</td>
<td>当前不是web环境</td>
</tr>
<tr>
<td>@ConditionalOnJndi</td>
<td>JNDI存在指定项</td>
</tr>
</tbody>
</table>


                

                
                <hr>
                <ul class="pager">
                    
                    
                    <li class="next">
                        <a href="/post/springcloudconfig/" data-toggle="tooltip" data-placement="top" title="Spring Cloud Config分享">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

                



            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        <a href="/tags/jvm" title="jvm">
                            jvm
                        </a>
                        
                        
                        
                        <a href="/tags/k8s" title="k8s">
                            k8s
                        </a>
                        
                        
                        
                        <a href="/tags/kafka" title="kafka">
                            kafka
                        </a>
                        
                        
                        
                        <a href="/tags/life" title="life">
                            life
                        </a>
                        
                        
                        
                        <a href="/tags/spring-boot" title="spring-boot">
                            spring-boot
                        </a>
                        
                        
                        
                        <a href="/tags/spring-cloud" title="spring-cloud">
                            spring-cloud
                        </a>
                        
                        
                        
                        <a href="/tags/sql" title="sql">
                            sql
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:xiaozzk@163.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    <li>
                        <a target="_blank" href="/img/wechat_qrcode.jpg">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    <li>
                        <a target="_blank" href="https://github.com/xiaozzk">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    <li>
                        <a target="_blank" href="https://gitee.com/xiaozzk">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-git fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Zhenkun Blog 2023
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body>
</html>
